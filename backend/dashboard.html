<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gonah Homes - Management Dashboard</title>
    <!-- Firebase SDKs for App, Auth, and Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <!-- EmailJS -->
    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font & Icons -->
    <link rel="stylesheet" href="dashboard.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Dashboard Script (must be after Firebase SDKs!) -->
    <script src="dashboard.js"></script>
</head>
<body>
    <!-- Login Modal -->
    <div id="login-modal" class="modal active">
        <div class="modal-content">
            <h2><i class="fas fa-lock"></i> Gonah Homes Management Access</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="username"><i class="fas fa-user"></i> Email</label>
                    <input type="email" id="username" required placeholder="Email address">
                </div>
                <div class="form-group">
                    <label for="password"><i class="fas fa-key"></i> Password</label>
                    <input type="password" id="password" required placeholder="Password">
                </div>
                <div id="login-error" class="error-message"></div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> Login to Dashboard
                </button>
            </form>
        </div>
    </div>

    <div id="dashboard" class="dashboard hidden">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-home"></i> Gonah Homes</h2>
                <p>Management Dashboard</p>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-link active" data-section="overview">
                    <i class="fas fa-chart-line"></i> Dashboard
                </a>
                <a href="#" class="nav-link" data-section="bookings">
                    <i class="fas fa-calendar-check"></i> Bookings
                </a>
                <a href="#" class="nav-link" data-section="analytics">
                    <i class="fas fa-chart-bar"></i> Analytics
                </a>
                <a href="#" class="nav-link" data-section="clients">
                    <i class="fas fa-users"></i> Clients
                </a>
                <a href="#" class="nav-link" data-section="messages">
                    <i class="fas fa-envelope"></i> Messages
                </a>
                <a href="#" class="nav-link" data-section="reviews">
                    <i class="fas fa-star"></i> Reviews
                </a>
                <a href="#" class="nav-link" data-section="whatsapp">
                    <i class="fab fa-whatsapp"></i> WhatsApp
                </a>
                <a href="#" class="nav-link" data-section="settings">
                    <i class="fas fa-cog"></i> Settings
                </a>
            </nav>
            <div class="sidebar-footer">
                <a href="../index.html" class="btn btn-outline btn-sm">
                    <i class="fas fa-globe"></i> View Website
                </a>
                <button class="btn btn-danger btn-sm" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h1 id="page-title">Management Dashboard</h1>
                <div class="header-actions">
                    <div class="notifications">
                        <button class="notification-btn" onclick="toggleNotifications()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-count" id="notification-count">0</span>
                        </button>
                        <div class="notification-dropdown" id="notification-dropdown">
                            <div class="notification-header">
                                <h4>Recent Notifications</h4>
                                <button onclick="markAllRead()">Mark all read</button>
                            </div>
                            <div class="notification-list" id="notification-list"></div>
                        </div>
                    </div>
                    <div class="admin-info">
                        <i class="fas fa-user-shield"></i>
                        <span>Administrator</span>
                    </div>
                </div>
            </header>

            <div class="content-body">
                <!-- Dashboard Overview -->
                <section id="overview-section" class="content-section active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
                            <div class="stat-info">
                                <h3 id="total-bookings">0</h3>
                                <p>Total Bookings</p>
                                <span class="stat-change" id="booking-change">+0% this month</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                            <div class="stat-info">
                                <h3 id="total-revenue">KSh 0</h3>
                                <p>Total Revenue</p>
                                <span class="stat-change" id="revenue-change">+0% this month</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-users"></i></div>
                            <div class="stat-info">
                                <h3 id="total-clients">0</h3>
                                <p>Total Clients</p>
                                <span class="stat-change" id="client-change">+0% this month</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-star"></i></div>
                            <div class="stat-info">
                                <h3 id="avg-rating">0.0</h3>
                                <p>Average Rating</p>
                                <span class="stat-change" id="rating-change">+0% this month</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-grid">
                        <div class="chart-card">
                            <h3>Recent Activity</h3>
                            <div id="recent-activity"></div>
                        </div>
                        <div class="chart-card">
                            <h3>Quick Actions</h3>
                            <div class="quick-actions">
                                <button class="action-btn" onclick="showSection('bookings')">
                                    <i class="fas fa-plus"></i> View Bookings
                                </button>
                                <button class="action-btn" onclick="showSection('messages')">
                                    <i class="fas fa-envelope"></i> Check Messages
                                </button>
                                <button class="action-btn" onclick="showSection('analytics')">
                                    <i class="fas fa-chart-bar"></i> View Analytics
                                </button>
                                <button class="action-btn" onclick="openWhatsApp()">
                                    <i class="fab fa-whatsapp"></i> WhatsApp
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Analytics Section -->
                <section id="analytics-section" class="content-section">
                    <div class="section-header">
                        <h2>Analytics & Insights</h2>
                    </div>
                    
                    <div class="analytics-grid">
                        <div class="chart-card">
                            <h3>Most Booked Accommodations</h3>
                            <canvas id="accommodationChart"></canvas>
                            <div id="popular-accommodation" class="chart-summary"></div>
                        </div>
                        
                        <div class="chart-card">
                            <h3>Monthly Booking Trends</h3>
                            <canvas id="monthlyChart"></canvas>
                            <div id="booking-trends" class="chart-summary"></div>
                        </div>
                        
                        <div class="chart-card">
                            <h3>Client Retention</h3>
                            <canvas id="clientChart"></canvas>
                            <div id="repeat-clients" class="chart-summary"></div>
                        </div>
                        
                        <div class="chart-card">
                            <h3>Revenue Projections</h3>
                            <canvas id="projectionChart"></canvas>
                            <div id="next-month-projection" class="chart-summary"></div>
                        </div>
                    </div>
                </section>

                <!-- Bookings Management -->
                <section id="bookings-section" class="content-section">
                    <div class="section-header">
                        <h2>Bookings Management</h2>
                        <div class="search-bar">
                            <input type="text" id="booking-search" placeholder="Search bookings...">
                            <select id="booking-filter">
                                <option value="">All Bookings</option>
                                <option value="pending">Pending</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Guest</th>
                                    <th>Accommodation</th>
                                    <th>Check-in</th>
                                    <th>Check-out</th>
                                    <th>Guests</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="bookings-table"></tbody>
                        </table>
                    </div>
                </section>

                <!-- Messages & Communication -->
                <section id="messages-section" class="content-section">
                    <div class="section-header">
                        <h2>Messages & Communication</h2>
                    </div>
                    <div class="messages-container">
                        <div class="messages-list" id="messages-list"></div>
                        <div class="message-detail" id="message-detail">
                            <div class="message-placeholder">
                                <i class="fas fa-envelope"></i>
                                <p>Select a message to view and reply</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Reviews Management -->
                <section id="reviews-section" class="content-section">
                    <div class="section-header">
                        <h2>Reviews Management</h2>
                    </div>
                    <div class="reviews-grid" id="reviews-grid"></div>
                </section>

                <!-- WhatsApp Integration -->
                <section id="whatsapp-section" class="content-section">
                    <div class="section-header">
                        <h2>WhatsApp Communication</h2>
                    </div>
                    <div class="whatsapp-container">
                        <div class="whatsapp-info">
                            <h3><i class="fab fa-whatsapp"></i> Direct WhatsApp Communication</h3>
                            <p>Communicate directly with guests via WhatsApp for instant support</p>
                        </div>
                        <div class="whatsapp-actions">
                            <div class="quick-messages">
                                <h4>Quick Messages</h4>
                                <button class="whatsapp-btn" onclick="sendQuickMessage('welcome')">
                                    <i class="fab fa-whatsapp"></i> Welcome Message
                                </button>
                                <button class="whatsapp-btn" onclick="sendQuickMessage('checkin')">
                                    <i class="fab fa-whatsapp"></i> Check-in Instructions
                                </button>
                                <button class="whatsapp-btn" onclick="sendQuickMessage('checkout')">
                                    <i class="fab fa-whatsapp"></i> Check-out Reminder
                                </button>
                            </div>
                            <div class="custom-message">
                                <h4>Send Custom Message</h4>
                                <select id="client-select">
                                    <option value="">Select a guest...</option>
                                </select>
                                <textarea id="custom-message" placeholder="Type your message..."></textarea>
                                <button class="btn btn-primary" onclick="sendCustomWhatsApp()">
                                    <i class="fab fa-whatsapp"></i> Send WhatsApp
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Clients Management -->
                <section id="clients-section" class="content-section">
                    <div class="section-header">
                        <h2>Client Management</h2>
                        <input type="text" id="client-search" placeholder="Search clients...">
                    </div>
                    <div class="clients-grid" id="clients-grid"></div>
                </section>

                <!-- Settings -->
                <section id="settings-section" class="content-section">
                    <div class="section-header">
                        <h2>System Settings</h2>
                    </div>
                    <div class="settings-grid">
                        <div class="setting-card">
                            <h3>Notification Settings</h3>
                            <form id="notification-settings">
                                <label>
                                    <input type="checkbox" id="email-notifications" checked>
                                    Email Notifications
                                </label>
                                <label>
                                    <input type="checkbox" id="whatsapp-notifications" checked>
                                    WhatsApp Notifications
                                </label>
                                <button type="submit" class="btn btn-primary">Save Settings</button>
                            </form>
                        </div>
                        <div class="setting-card">
                            <h3>Business Information</h3>
                            <form id="business-settings">
                                <div class="form-group">
                                    <label>Business Name</label>
                                    <input type="text" value="Gonah Homes" id="business-name">
                                </div>
                                <div class="form-group">
                                    <label>Contact Email</label>
                                    <input type="email" value="gonahhomes0@gmail.com" id="contact-email">
                                </div>
                                <div class="form-group">
                                    <label>WhatsApp Number</label>
                                    <input type="text" value="+254799466723" id="whatsapp-number">
                                </div>
                                <button type="submit" class="btn btn-primary">Update Information</button>
                            </form>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>
</body>
    </html>
